<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telugu NRI Radio - Stream Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
        }
        button {
            background: #ff6600;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #e55a00;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            background: #333;
            border-radius: 5px;
        }
        .error {
            background: #660000;
        }
        .success {
            background: #006600;
        }
        .loading {
            background: #000066;
        }
        audio {
            width: 100%;
            margin: 10px 0;
        }
        .url-list {
            margin: 20px 0;
        }
        .url-item {
            padding: 5px;
            margin: 2px 0;
            background: #333;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Telugu NRI Radio - Stream Test</h1>
        
        <div id="status" class="status">
            Ready to test streaming...
        </div>

        <div>
            <button onclick="testStream(0)" id="testBtn">Test Primary Stream</button>
            <button onclick="testAllStreams()" id="testAllBtn">Test All Streams</button>
            <button onclick="stopStream()" id="stopBtn">Stop</button>
        </div>

        <audio id="audioPlayer" controls style="width: 100%; margin: 20px 0;">
            Your browser does not support the audio element.
        </audio>

        <div class="url-list">
            <h3>Stream URLs Being Tested:</h3>
            <div class="url-item" id="url-0">1. https://cast5.asurahosting.com:2199/proxy/telugunr?mp=/stream</div>
            <div class="url-item" id="url-1">2. http://cast5.asurahosting.com:2199/proxy/telugunr?mp=/stream</div>
            <div class="url-item" id="url-2">3. https://cast5.asurahosting.com:2199/stream/telugunr</div>
            <div class="url-item" id="url-3">4. http://cast5.asurahosting.com:2199/stream/telugunr</div>
            <div class="url-item" id="url-4">5. https://cast5.asurahosting.com:2199/telugunr</div>
            <div class="url-item" id="url-5">6. http://cast5.asurahosting.com:2199/telugunr</div>
        </div>

        <div id="logs" style="background: #111; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; height: 200px; overflow-y: auto; margin-top: 20px;">
        </div>
    </div>

    <script>
        const streamUrls = [
            'https://cast5.asurahosting.com:2199/proxy/telugunr?mp=/stream',
            'http://cast5.asurahosting.com:2199/proxy/telugunr?mp=/stream',
            'https://cast5.asurahosting.com:2199/stream/telugunr',
            'http://cast5.asurahosting.com:2199/stream/telugunr',
            'https://cast5.asurahosting.com:2199/telugunr',
            'http://cast5.asurahosting.com:2199/telugunr'
        ];

        const audioPlayer = document.getElementById('audioPlayer');
        const statusDiv = document.getElementById('status');
        const logsDiv = document.getElementById('logs');

        let currentUrlIndex = 0;
        let isTestingAll = false;

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logsDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            logsDiv.scrollTop = logsDiv.scrollHeight;
            console.log(message);
        }

        function updateStatus(message, className = '') {
            statusDiv.textContent = message;
            statusDiv.className = `status ${className}`;
            log(`STATUS: ${message}`);
        }

        function highlightUrl(index, className = '') {
            // Reset all URLs
            for (let i = 0; i < streamUrls.length; i++) {
                const urlElement = document.getElementById(`url-${i}`);
                urlElement.style.background = '#333';
            }
            
            // Highlight current URL
            if (index >= 0 && index < streamUrls.length) {
                const urlElement = document.getElementById(`url-${index}`);
                urlElement.style.background = className === 'error' ? '#660000' : 
                                            className === 'success' ? '#006600' : '#000066';
            }
        }

        async function testStream(urlIndex) {
            if (urlIndex >= streamUrls.length) {
                updateStatus('All streams tested - none working', 'error');
                return;
            }

            const url = streamUrls[urlIndex];
            updateStatus(`Testing stream ${urlIndex + 1}/${streamUrls.length}...`, 'loading');
            highlightUrl(urlIndex, 'loading');
            
            log(`Testing URL: ${url}`);

            try {
                // Create a fresh audio element
                audioPlayer.src = url + '?t=' + Date.now();
                audioPlayer.load();

                // Set up event handlers
                const timeoutId = setTimeout(() => {
                    log(`TIMEOUT: Stream ${urlIndex + 1} timed out after 10 seconds`);
                    highlightUrl(urlIndex, 'error');
                    if (isTestingAll) {
                        testStream(urlIndex + 1);
                    } else {
                        updateStatus(`Stream ${urlIndex + 1} timed out`, 'error');
                    }
                }, 10000);

                audioPlayer.oncanplay = () => {
                    clearTimeout(timeoutId);
                    log(`SUCCESS: Stream ${urlIndex + 1} can play`);
                    updateStatus(`Stream ${urlIndex + 1} working! Playing...`, 'success');
                    highlightUrl(urlIndex, 'success');
                    audioPlayer.play();
                };

                audioPlayer.onerror = (e) => {
                    clearTimeout(timeoutId);
                    const error = audioPlayer.error;
                    const errorMessage = error ? `Error code ${error.code}: ${getErrorMessage(error.code)}` : 'Unknown error';
                    log(`ERROR: Stream ${urlIndex + 1} failed - ${errorMessage}`);
                    highlightUrl(urlIndex, 'error');
                    
                    if (isTestingAll) {
                        setTimeout(() => testStream(urlIndex + 1), 1000);
                    } else {
                        updateStatus(`Stream ${urlIndex + 1} failed: ${errorMessage}`, 'error');
                    }
                };

                audioPlayer.onplaying = () => {
                    log(`PLAYING: Stream ${urlIndex + 1} is now playing`);
                    updateStatus(`Stream ${urlIndex + 1} playing successfully!`, 'success');
                    isTestingAll = false; // Stop testing others if one works
                };

            } catch (error) {
                log(`EXCEPTION: ${error.message}`);
                updateStatus(`Exception: ${error.message}`, 'error');
                highlightUrl(urlIndex, 'error');
                
                if (isTestingAll) {
                    setTimeout(() => testStream(urlIndex + 1), 1000);
                }
            }
        }

        function testAllStreams() {
            isTestingAll = true;
            log('=== Starting comprehensive stream test ===');
            testStream(0);
        }

        function stopStream() {
            audioPlayer.pause();
            audioPlayer.src = '';
            updateStatus('Stream stopped');
            isTestingAll = false;
            log('Stream stopped by user');
            
            // Reset URL highlighting
            for (let i = 0; i < streamUrls.length; i++) {
                document.getElementById(`url-${i}`).style.background = '#333';
            }
        }

        function getErrorMessage(errorCode) {
            switch (errorCode) {
                case 1: return 'MEDIA_ERR_ABORTED - The fetching process for the media resource was aborted by the user agent';
                case 2: return 'MEDIA_ERR_NETWORK - A network error caused the user agent to stop fetching the media resource';
                case 3: return 'MEDIA_ERR_DECODE - An error occurred while decoding the media resource';
                case 4: return 'MEDIA_ERR_SRC_NOT_SUPPORTED - The media resource is not supported';
                default: return 'Unknown error';
            }
        }

        // Initialize
        log('Stream test page loaded');
        log(`Testing ${streamUrls.length} different stream URLs`);
    </script>
</body>
</html>
